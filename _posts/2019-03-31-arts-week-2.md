---
layout: post
title:  'ARTS ç¬¬äºŒå‘¨'
date:   2019-03-31 10:00:00 +0800
tags: 'ARTS'
color: rgb(102, 88, 192)
cover: 'https://www.notion.so/image/https%3A%2F%2Fwww.notion.so%2Fimages%2Fpage-cover%2Fmet_vincent_van_gogh_irises.jpg?table=block&id=511ae90f-9dbf-4154-8525-25f4745d51e3&width=3730&cache=v2'
subtitle: 'ARTS Week-2'
---

## **Algorithm**

[204. è®¡æ•°è´¨æ•°](https://leetcode-cn.com/problems/count-primes/)

ç»Ÿè®¡æ‰€æœ‰å°äºŽéžè´Ÿæ•´æ•°Â *n*Â çš„è´¨æ•°çš„æ•°é‡ã€‚

**ç¤ºä¾‹:**

    è¾“å…¥: 10
    è¾“å‡º: 4
    è§£é‡Š: å°äºŽ 10 çš„è´¨æ•°ä¸€å…±æœ‰ 4 ä¸ª, å®ƒä»¬æ˜¯ 2, 3, 5, 7 ã€‚

è§£æ³•ä¸€ï¼Œæš´åŠ›æ³•ï¼š

```python
class Solution:
    def countPrimes(self, n: int) -> int:
        count = 0
        
        for i in range(n):
            if self.isPrime(i):
                count += 1
                
        return count
    
    def isPrime(self, n) -> bool:
        if n < 2:
            return False
        
        if n == 2:
            return True
        
        i = 2
        
        while i <= int(n ** 0.5):
            
            if n % i == 0:
                return False
            
            i += 1
            
        return True
```

å…¶ä¸­è¿™é‡Œåˆ©ç”¨äº†ä¸€ä¸ªæ•°å­¦è§„å¾‹ï¼š

å‡è®¾ä¸€ä¸ªæ•° N ä»–æœ‰ä¸¤ä¸ªçº¦æ•° aã€bï¼Œå½“ a = b æ—¶ï¼Œé‚£ä¹ˆå®ƒæ˜¯ä¸€ä¸ªåˆæ•°ï¼Œä¹Ÿå°±æ˜¯ a^2 = Nã€‚

å¦‚æžœä»–çš„è¿™ä¸¤ä¸ªçº¦æ•°éƒ½å¤§äºŽ æ ¹å· N ï¼Œä¹Ÿå°±æ˜¯ a > æ ¹å· Nï¼Œé‚£ä¹ˆä¸€å®šæœ‰ a ^ > Nã€‚

æ‰€ä»¥è‹¥ N ä¸æ˜¯è´¨æ•°ï¼Œé‚£ä¹ˆå¿…å®šå­˜åœ¨ä¸€ä¸ªçº¦æ•°å°äºŽç­‰äºŽæ ¹å· Nï¼ˆ1 é™¤å¤–ï¼‰ã€‚

è™½ç„¶åˆ©ç”¨äº†æ•°å­¦è§„å¾‹ï¼Œä½†æ˜¯æš´åŠ›æ³•è¶…æ—¶äº† ðŸ¤ªã€‚

è§£æ³•äºŒï¼ŒåŸƒæ‹‰æ‰˜è‰²å°¼ç­›ç½‘æ³•ï¼š

![](/assets/images/2019-03-31-arts-week-2/20160201110938143-49608c24-5375-41bc-82a6-0ed7cc14e565.gif)

å¦‚ GIF æ‰€ç¤ºï¼Œé¦–å…ˆç­›é€‰å°äºŽ N çš„ 2 çš„å€æ•°ï¼Œä»–ä»¬å¿…å®šä¸æ˜¯è´¨æ•°ã€‚ç„¶åŽç­›é€‰ 3 çš„å€æ•°ã€5 çš„å€æ•°ã€7 çš„å€æ•° ... ä»¥æ­¤ç±»æŽ¨ã€‚å‰©ä¸‹çš„æ•°å°±æ˜¯è´¨æ•°äº†ã€‚

```python
class Solution:
    def countPrimes(self, n: int) -> int:
        if n <= 2:
            return 0
        
        arr = [1] * n
        
        for i in range(2, n):
            
            j = 2
            mul = i * j
            
            while mul < n:
                
                arr[mul] = 0
                j += 1
                mul = i * j
        
        return sum(arr[2:])
```

è™½ç„¶åˆ©ç”¨äº†ç®—æ³•ï¼Œä½†æ˜¯è¿˜æ˜¯è¶…æ—¶äº† ðŸ¥¶ã€‚

å°è¯•ç”¨ Python ä¸­çš„åˆ‡ç‰‡ä¼˜åŒ–ä¸€ä¸‹ï¼ŒæŠŠåŽŸæ¥çš„é¡ºåºèµ‹å€¼ä¸º 0 æ”¹ä¸ºæ‰¹é‡èµ‹å€¼ä¸º 0ï¼š

```python
class Solution:
    def countPrimes(self, n: int) -> int:
        if n <= 2:
            return 0
        
        arr = [1] * n
        
        for i in range(2, int(n)):
            if arr[i] == 1:
                arr[2*i:n:i] = [0] * len(arr[2*i:n:i])
        
        return sum(arr[2:])
```

æˆ‘ä»¬å‘çŽ°åœ¨ä¸Šé¢çš„ç­›æ³•ä¸­æœ‰çš„æ•°å­—æ˜¯å¤šä¸ªè´¨æ•°çš„å€æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒå¯èƒ½ä¼šè¢«é‡å¤è®¡ç®—å¤šæ¬¡ï¼Œæ¯”å¦‚è¯´6 åŒæ—¶æ˜¯ 2 ä¸Ž 3 çš„å€æ•°ï¼Œå®ƒåœ¨è®¡ç®—æ—¶å°±è¢«è®¿é—®äº†ä¸¤æ¬¡ï¼Œæ‰€ä»¥åº”è¯¥è¿˜æœ‰ä¼˜åŒ–çš„ç©ºé—´ã€‚

æ‰€ä»¥åœ¨ç½‘ä¸Šçœ‹åˆ°äº†ä¸€ç§ç®—æ³•ï¼Œæ¬§æ‹‰å‡½æ•°çº¿æ€§ç­›æ³•ã€‚åˆæ˜¯æ•°å­¦ï¼Œé«˜æ•°è¦å›žåŽ»é‡æ–°å­¦äº† ðŸ˜µã€‚

è¿™é‡Œæ”¾ä¸€ä¸‹[é“¾æŽ¥ðŸ”—](https://blog.csdn.net/qq_17550379/article/details/86062147)ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥è‡ªå·±åŽ»çœ‹çœ‹ã€‚

è¿™é“ leetcode é¢˜è™½ç„¶æ˜¯æ ‡ç€æ˜¯ç®€å•çš„ï¼Œæˆ‘ä¹Ÿè§‰å¾—å¹¶ä¸ç®€å•ã€‚

[Github ä»“åº“åœ°å€](https://github.com/elfgzp/Leetcode/blob/master/204.count-primes.py)

## **Review**

[ã€ŠDistributed systems theory for the distributed systems engineerã€‹](https://www.the-paper-trail.org/post/2014-08-09-distributed-systems-theory-for-the-distributed-systems-engineer/)

ä½œè€…åœ¨æ–‡ç« ä¸­æåˆ°äº†ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿç†è®ºæœ‰å¾ˆå¤šï¼š

- [FLP ä¸å¯èƒ½åŽŸç†](https://www.jianshu.com/p/b620cbabf857)ï¼šåœ¨ç½‘ç»œå¯é ï¼Œä½†å…è®¸èŠ‚ç‚¹å¤±æ•ˆï¼ˆå³ä¾¿åªæœ‰ä¸€ä¸ªï¼‰çš„æœ€å°åŒ–å¼‚æ­¥æ¨¡åž‹ç³»ç»Ÿä¸­ï¼Œä¸å­˜åœ¨ä¸€ä¸ªå¯ä»¥è§£å†³ä¸€è‡´æ€§é—®é¢˜çš„ç¡®å®šæ€§å…±è¯†ç®—æ³•ã€‚
- [Paxos ç®—æ³•](https://zh.wikipedia.org/wiki/Paxos%E7%AE%97%E6%B3%95)
- [æ‹œå åº­å°†å†›é—®é¢˜ï¼ˆByzantine Generals Problem)](https://zh.wikipedia.org/zh/%E6%8B%9C%E5%8D%A0%E5%BA%AD%E5%B0%86%E5%86%9B%E9%97%AE%E9%A2%98)

...

ä½†æ˜¯å¾€å¾€ä¸Šé¢ç½—åˆ—å‡ºæ¥çš„ç†è®ºéƒ½æ˜¯éžå¸¸æ·±å¥¥ï¼Œå¤æ‚éƒ½éœ€è¦éžå¸¸è®¤çœŸèŠ±å¾ˆå¤šæ—¶é—´åŽ»ç†è§£å’Œå­¦ä¹ ï¼Œä½†æ˜¯å¾€å¾€åŽ»å­¦ä¹ è¿™äº›ç†è®ºçŸ¥è¯†çš„å­¦ä¹ æ–¹å‘æ°æ°ä¸æ˜¯é‚£ä¹ˆçš„å¥½ï¼ˆé™¤éžä½ æ˜¯ä½œä¸ºåšå£«æˆ–ç ”ç©¶ç”ŸåŽ»å­¦ä¹ ï¼‰ã€‚

æ‰€ä»¥ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿå·¥ç¨‹å¸ˆåˆ°åº•éœ€è¦å­¦ä¹ é‚£äº›åˆ†å¸ƒå¼ç†è®ºçŸ¥è¯†ï¼Ÿ

é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å­¦ä¹ å’Œé˜…è¯»ä¸€äº›ä¹¦ç±ï¼ŒåŽ»äº†è§£åˆ†å¸ƒå¼ç³»ç»Ÿå·¥ç¨‹å¸ˆåœ¨æž„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿè¿‡ç¨‹ä¸­ï¼Œä¼šé‡åˆ°çš„ä¸€äº›éš¾ç‚¹ã€é—®é¢˜ï¼Œä¸ºåŽé¢æ›´åŠ å¤æ‚çš„åˆ†å¸ƒå¼é—®é¢˜ç»†èŠ‚ç ”ç©¶æ‰“ä¸‹åŸºç¡€ï¼Œä½œè€…ä¹Ÿç½—åˆ—äº†ä¸€äº›æ–‡å†…å®¹ï¼Œè¿™é‡Œå°±ä¸è¯¦ç»†ä»‹ç»åªæŠŠä»–ä»¬åˆ—å‡ºæ¥ã€‚

- [Distributed Systems for Fun and Profit](http://book.mixu.net/distsys/)
- [Notes on distributed systems for young bloods](http://www.somethingsimilar.com/2013/01/14/notes-on-distributed-systems-for-young-bloods/)
- [A Note on Distributed Systems](http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.41.7628)
- [The fallacies of distributed computing](http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.41.7628)

ç„¶åŽæåˆ°äº†è®¾è®¡åˆ†å¸ƒå¼ç³»ç»Ÿéœ€è¦çŸ¥é“çš„ä¸€äº›åŸºæœ¬çŸ¥è¯†å’Œéœ€è¦åšçš„ä¸œè¥¿ï¼Œå¦‚æ•…éšœæ£€æµ‹ã€å¼¹åŠ›è®¾è®¡ï¼Œä¸Žä¸€è‡´æ€§ç›¸å…³çš„äºŒé˜¶æ®µæäº¤ã€ä¸‰é˜¶æ®µæäº¤ï¼Œè¿˜æœ‰ Gossip ç®—æ³•ï¼Œè¿˜æœ‰ CAP å®šç†ç­‰ç­‰ã€‚

è¿™äº›éƒ½æ˜¯æˆ‘æž¶æž„å¸ˆæˆé•¿ä¹‹è·¯ä¸Šçš„å¿…ç»å­¦ä¹ ä¹‹è·¯å•Š ðŸŽ“ï¼Œéœ€è¦æ…¢æ…¢åŽ»æ¶ˆåŒ–å¸æ”¶äº†ã€‚

## **Tip**

è¿™é‡Œåˆ†äº« Python çš„ä¸¤ä¸ªå·¥å…·å‡½æ•°ï¼Œä¸€ä¸ªæ˜¯åˆ©ç”¨çº¿ç¨‹æ± å°†æŸä¸ªå‡½æ•°è½¬æ¢ä¸º Python çš„å¼‚æ­¥å‡½æ•°ï¼Œè¿”å›žä¸€ä¸ªåç¨‹å¯¹è±¡ã€‚å¦ä¸€ä¸ªæ˜¯å°†å¼‚æ­¥å‡½æ•°è½¬æ¢ä¸ºåŒæ­¥å‡½æ•°ï¼Œå°†å…¶ç»“æžœç›´æŽ¥è¿”å›žã€‚

```python
    import functools
â€‹    
    def force_async(fn):
        """
        turns a sync function to async function using threads
        """
        from concurrent.futures import ThreadPoolExecutor
        import asyncio
        pool = ThreadPoolExecutor()
    
        @functools.wraps(fn)
        def wrapper(*args, **kwargs):
            future = pool.submit(fn, *args, **kwargs)
            return asyncio.wrap_future(future)  # make it awaitable
    
        return wrapper
â€‹    
    def force_sync(fn):
        """
        turn an async function to sync function
        """
        import asyncio
    
        @functools.wraps(fn)
        def wrapper(*args, **kwargs):
            res = fn(*args, **kwargs)
            if asyncio.iscoroutine(res):
                return asyncio.get_event_loop().run_until_complete(res)
            return res
    
        return wrapper
```

ä»–ä»¬ä¸¤ä¸ªåˆ†åˆ«æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿ

ä¸¾ä¸ªä¾‹å­ï¼Œå½“æˆ‘ä»¬ç”¨åˆ°ä¸€äº›ç¬¬ä¸‰æ–¹çš„åº“ï¼Œä»–ä¼šè°ƒç”¨ IOï¼Œæ¯”å¦‚ç½‘ç»œè¯·æ±‚ï¼Œæ–‡ä»¶è¯»å–ç­‰ç­‰ã€‚æˆ‘ä»¬åœ¨ä¸€äº›ç±»ä¸­éœ€è¦å°†ç±»æŠ½è±¡ä¸ºå¼‚æ­¥å‡½æ•°ï¼ŒæŠ½è±¡çš„æ–¹æ³•è¿”å›žçš„ç»“æžœå¿…é¡»æ˜¯ä¸€ä¸ª `awaitabale`å¯¹è±¡å³åç¨‹ï¼Œä½†æ˜¯æˆ‘ä»¬è°ƒç”¨çš„åº“æ°å¥½æ˜¯åŒæ­¥çš„ï¼Œè¿™æ—¶å€™å°±å¯ä»¥åˆ©ç”¨ç¬¬ä¸€ä¸ªè£…é¥°å™¨ã€‚

ç¬¬äºŒä¸ªè£…é¥°å™¨å¯ä»¥åˆ©ç”¨åœ¨æµ‹è¯•ä¸­ï¼Œæ¯”å¦‚æŸä¸ªå‡½æ•°å®ƒæ˜¯å¼‚æ­¥çš„ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ `setup_*` ä¸­è°ƒç”¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨è£…é¥°å™¨å°†å…¶å˜ä¸ºåŒæ­¥å‡½æ•°ã€‚

ä»–ä»¬çš„å®žçŽ°åŽŸç†éžå¸¸ç®€å•ï¼Œ`force_async` æ˜¯åˆ©ç”¨çº¿ç¨‹æ± å®žçŽ°çš„ï¼Œ`force_sync` åˆ™æ˜¯å°†å¼‚æ­¥å‡½æ•°åœ¨äº‹ä»¶å¾ªçŽ¯ä¸­æ‰§è¡Œå®ŒåŽå°†ç»“æžœè¿”å›žã€‚

## **Share**

[å·¦è€³å¬é£Ž ã€Š41 å¼¹åŠ›è®¾è®¡ç¯‡ä¹‹â€œè®¤è¯†æ•…éšœå’Œå¼¹åŠ›è®¾è®¡â€ã€‹](https://time.geekbang.org/column/article/3912)

ä¸è¦å°è¯•åŽ»é¿å…æ•…éšœï¼Œè€Œæ˜¯è¦æŠŠå¤„ç†æ•…éšœçš„ä»£ç å½“æˆæ­£å¸¸çš„åŠŸèƒ½ååœ¨æž¶æž„é‡Œå†™åœ¨ä»£ç é‡Œã€‚